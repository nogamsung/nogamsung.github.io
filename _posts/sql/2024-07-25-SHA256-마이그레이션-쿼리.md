---
layout: post
title: SHA256 ë§ˆì´ê·¸ë ˆì´ì…˜ ì¿¼ë¦¬
date: 2024-07-25
description: 
categories:
  - sql, query
img: 
tags:
  - mysql
  - sql
  - query
  - migration
  - sha256
toc: true
toc_sticky: true
toc_label: ëª©ì°¨
---
# ê°œìš”

ì•”í˜¸í™” ì¢…ë¥˜ëŠ” í¬ê²Œ ë‹¨ë°©í–¥ê³¼ ì–‘ë°©í–¥ìœ¼ë¡œ ë‚˜ë‰œë‹¤.

ì–‘ë°©í–¥ì€ ì•”í˜¸í™” í•œ ë‹¤ìŒ ë‹¤ì‹œ í‰ë¬¸ìœ¼ë¡œ ë³µêµ¬ê°€ ê°€ëŠ¥í•œ ì•”í˜¸í™” ë°©ì‹ì´ê³ , ë‹¨ë°©í–¥ì€ ì•”í˜¸í™” í•œ ë’¤ ë‹¤ìŒ ë‹¤ì‹œ í‰ë¬¸ìœ¼ë¡œ ë³µêµ¬ê°€ ë¶ˆê°€ëŠ¥í•˜ë‹¤.

ê·¸ë˜ì„œ ISMS ê°™ì€ ë³´ì•ˆ ì¸ì¦ì„ ë°›ì„ë•Œ ë¹„ë°€ë²ˆí˜¸ì™€ ê°™ì€ ë¯¼ê°í•œ ê°œì¸ì •ë³´ëŠ” ë¬´ì¡°ê±´ ë‹¨ë°©í–¥ ì•”í˜¸í™” ëŒ€ìƒì´ë‹¤.

ê·¸ëŸ¼ ì´ì œ ë¬´ì¤‘ë‹¨ ì„œë¹„ìŠ¤ì—ì„œ SHA256ìœ¼ë¡œ ë°ì´í„°ë§ˆì´ê·¸ë ˆì´ì…˜ í•´ë³´ì.

ERDëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤í•˜ê³  ì˜ˆì‹œë¥¼ ë“¤ê² ë‹¤.

![](../../assets/img/2024/07/25-1.png)

## ì‹¤í–‰ ê³„íš ğŸ“ƒ

ì¿¼ë¦¬ë¥¼ ì§¤ë•Œ ì‹¤í–‰ ê³„íšì„ ì² ì €í•˜ê²Œ ì„¸ìš°ì§€ ì•Šìœ¼ë©´ ì‹¤ìˆ˜í•˜ê¸° ë§ˆë ¨ì´ë‹¤.

í…ŒìŠ¤íŠ¸ëŠ” í¬ê²Œ ì¿¼ë¦¬ ì‹¤í–‰ ì „ê³¼ ì¿¼ë¦¬ ì‹¤í–‰ í›„ë¡œ ë‚˜ëˆˆë‹¤. ì¿¼ë¦¬ ì‹¤í–‰ ì „ì—ëŠ” íŠ¹ì • ë°ì´í„°ì—ë§Œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ë©° ì •ìƒì ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ë˜ëŠ”ì§€ í™•ì¸í•´ì•¼ ëœë‹¤. 

ê·¸ë¦¬ê³  ë³¸ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰ ì‹œí‚¨ ë’¤ì— ë°ì´í„°ê°€ ì •ìƒì ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ëëŠ”ì§€ í™•ì¸í•˜ê³  ì„œë¹„ìŠ¤ì— ì´ìƒì´ ì—†ëŠ”ì§€ auth ì„œë²„ ë¡œê·¸ì™€ DBì— ë°ì´í„°ë“¤ì„ í™•ì¸í•´ì•¼ ëœë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ í…ŒìŠ¤íŠ¸ë¥¼ í•  ìˆ˜ ìˆëŠ” ë°ì´í„°ê°€ 20ê°œë¼ê³  í• ë•Œ, 10ê°œëŠ” ì¿¼ë¦¬ ì‹¤í–‰ ì „ì— `IN`ì ˆì„ í†µí•´ ì‹¤í–‰ ì‹œì¼œë³´ê³  í™•ì¸í•œë‹¤. ê·¸ í›„ ë‚˜ë¨¸ì§€ 10ê°œëŠ” ë³¸ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰ì‹œí‚¤ê³  ë‹¤ì‹œ í•œë²ˆ í™•ì¸í•˜ëŠ” ìš©ë„ë¡œ ì‚¬ìš©í•œë‹¤.

í…ŒìŠ¤íŠ¸ IDê°€ ì´ 10ê°œ(ID = 1 ~ 10)ì´ë¼ í•˜ì.

## ì‹¤í–‰ ì „ í…ŒìŠ¤íŠ¸ ğŸ§

##### 1ï¸âƒ£ í…ŒìŠ¤íŠ¸ ëŒ€ìƒ í™•ì¸

```sql
SELECT u.user_id, u.username, u.password, up.user_password_id, up.password_sha256  
FROM users u  
LEFT JOIN user_password up ON up.user_id = u.user_id  
WHERE up.user_password_id IS NULL AND  
    u.user_id IN (1, 2, 3, 4, 5);
```

![](../../assets/img/2024/07/25-2.png)

##### 2ï¸âƒ£ í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ì¿¼ë¦¬ ì‹¤í–‰

```sql
INSERT INTO user_password(user_id, password_sha256)  
(  
    SELECT u.user_id, SHA2(u.password, 256)  
    FROM users u  
    LEFT JOIN user_password up ON up.user_id = u.user_id  
    WHERE up.user_id IS NULL AND  
       u.user_id IN (1, 2, 3, 4, 5)  
);
```

##### 3ï¸âƒ£ í…ŒìŠ¤íŠ¸ ë°ì´í„° DBë¡œ í™•ì¸

```sql
SELECT u.user_id, u.username, u.password, up.user_password_id, up.password_sha256  
FROM users u  
LEFT JOIN user_password up ON up.user_id = u.user_id  
WHERE u.user_id IN (1, 2, 3, 4, 5);
```

![](../../assets/img/2024/07/25-3.png)

##### 4ï¸âƒ£ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì„œë¹„ìŠ¤ë¡œ í™•ì¸

ì‹¤ì œ ì•± ë˜ëŠ” ì›¹ì—ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ì˜ë˜ì„œ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ë‹¨ê³„ë‹¤.

## ë³¸ ì¿¼ë¦¬ ì‹¤í–‰ ğŸ› ï¸

##### 1ï¸âƒ£ ì ìš© ëŒ€ìƒ ì¹´ìš´íŠ¸

```sql
SELECT COUNT(u.id)
FROM users u
LEFT JOIN user_password up ON up.user_id = u.user_id
WHERE up.id IS NULL;
```

![](../../assets/img/2024/07/25-4.png)

##### 2ï¸âƒ£ ì¿¼ë¦¬ ì‹¤í–‰ í›„ í™•ì¸ìš© ë°ì´í„° ì ê²€

```sql
SELECT u.user_id, u.username, u.password, up.user_password_id, up.password_sha256  
FROM users u  
LEFT JOIN user_password up ON up.user_id = u.user_id  
WHERE up.user_password_id IS NULL AND  
    u.user_id IN (6, 7, 8, 9, 10);
```

![](../../assets/img/2024/07/25-5.png)

##### 3ï¸âƒ£ ë§ˆì´ê·¸ë ˆì´ì…˜ ì¿¼ë¦¬ ì‹¤í–‰

```sql
INSERT INTO user_password(user_id, password_sha256)  
(  
    SELECT u.user_id, SHA2(u.password, 256)  
    FROM users u  
    LEFT JOIN user_password up ON up.user_id = u.user_id  
    WHERE up.user_id IS NULL 
);
```

## ì‹¤í–‰ í›„ í™•ì¸ ğŸ§

##### 1ï¸âƒ£ ì‹¤í–‰ í›„ í™•ì¸ìš© ë°ì´í„° DBë¡œ í™•ì¸

```sql
SELECT u.user_id, u.username, u.password, up.user_password_id, up.password_sha256  
FROM users u  
LEFT JOIN user_password up ON up.user_id = u.user_id  
WHERE u.user_id IN (6, 7, 8, 9, 10);
```

![](../../assets/img/2024/07/25-6.png)

##### 2ï¸âƒ£ ì‹¤í–‰ í›„ í™•ì¸ìš© ë°ì´í„° ì„œë¹„ìŠ¤ë¡œ í™•ì¸

## ë§ˆë¬´ë¦¬

Batchë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ì¿¼ë¦¬ë§Œìœ¼ë¡œë„ SHA256ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì•”í˜¸í™”í•˜ê³  ë§ˆì´ê·¸ë ˆì´ì…˜ ì§„í–‰í•  ìˆ˜ ìˆë‹¤.

## ì°¸ì¡°

- [https://helloworld.kurly.com/blog/distributed-redisson-lock/](https://helloworld.kurly.com/blog/distributed-redisson-lock/)